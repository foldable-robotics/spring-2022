<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="">
    <title>
Solving Nonlinear Problems with Scipy Optimize and pyCMA | Foldable Robotics
</title>

    <link href="/bootstrap-5.0.2-dist/css/bootstrap.min.css" rel="stylesheet">

<style>
  .bd-placeholder-img {
    font-size: 1.125rem;
    text-anchor: middle;
    -webkit-user-select: none;
    -moz-user-select: none;
    user-select: none;
  }

  @media (min-width: 768px) {
    .bd-placeholder-img-lg {
      font-size: 3.5rem;
    }
  }
</style>

<link rel="preconnect" href="https://fonts.gstatic.com">
<link href="https://fonts.googleapis.com/css2?family=Alfa+Slab+One&display=swap" rel="stylesheet">
<link href="https://fonts.googleapis.com/css2?family=Oleo+Script:wght@400;700&display=swap" rel="stylesheet"> 
<link href="https://fonts.googleapis.com/css2?family=Roboto:ital,wght@0,100;0,300;0,400;0,500;0,700;0,900;1,100;1,300;1,400;1,500;1,700;1,900&display=swap" rel="stylesheet"> 


<link href="/css/blog.css" rel="stylesheet">
<link href="/css/features.css" rel="stylesheet">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.5.0/font/bootstrap-icons.css">


    <script>
  MathJax = {
    tex: {
      inlineMath: [['$', '$'], ['\\(', '\\)']],
      displayMath: [['$$','$$'], ['\\[', '\\]']],
      processEscapes: true,
      processEnvironments: true
    },
    options: {
      skipHtmlTags: ['script', 'noscript', 'style', 'textarea', 'pre']
    }
  };

  window.addEventListener('load', (event) => {
      document.querySelectorAll("mjx-container").forEach(function(x){
        x.parentElement.classList += 'has-jax'})
    });

</script>
<script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
<script type="text/javascript" id="MathJax-script" async
  src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>

    <link rel="stylesheet" type="text/css" href="/hugo-cite.css" />

    <link rel="apple-touch-icon" sizes="57x57" href="/favicon/apple-icon-57x57.png">
<link rel="apple-touch-icon" sizes="60x60" href="/favicon/apple-icon-60x60.png">
<link rel="apple-touch-icon" sizes="72x72" href="/favicon/apple-icon-72x72.png">
<link rel="apple-touch-icon" sizes="76x76" href="/favicon/apple-icon-76x76.png">
<link rel="apple-touch-icon" sizes="114x114" href="/favicon/apple-icon-114x114.png">
<link rel="apple-touch-icon" sizes="120x120" href="/favicon/apple-icon-120x120.png">
<link rel="apple-touch-icon" sizes="144x144" href="/favicon/apple-icon-144x144.png">
<link rel="apple-touch-icon" sizes="152x152" href="/favicon/apple-icon-152x152.png">
<link rel="apple-touch-icon" sizes="180x180" href="/favicon/apple-icon-180x180.png">
<link rel="icon" type="image/png" sizes="192x192"  href="/favicon/android-icon-192x192.png">
<link rel="icon" type="image/png" sizes="32x32" href="/favicon/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="96x96" href="/favicon/favicon-96x96.png">
<link rel="icon" type="image/png" sizes="16x16" href="/favicon/favicon-16x16.png">
<link rel="manifest" href="/favicon/manifest.json">


  </head>
  <body>

    <div class="container">

      <header class="blog-header py-3">
  <div class="row flex-nowrap justify-content-between align-items-center">
    <div class="col-2 pt-1">
    </div>
    <div class="col-8 text-center">
      <a class="blog-header-logo text-dark" href="/">Foldable Robotics</a>
    </div>
    <div class="col-2 d-flex justify-content-end align-items-center">
    </div>
  </div>
</header>


      <nav class="navbar navbar-expand-lg navbar-light bg-light">
  <div class="container-fluid">
    <a class="navbar-brand" href="/">Home</a>
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>
    <div class="collapse navbar-collapse" id="navbarSupportedContent">
      <ul class="navbar-nav me-auto mb-2 mb-lg-0">
        
        
        <li class="nav-item dropdown">
          <a class="nav-link dropdown-toggle" href="#" id="navbarDropdown" role="button" data-bs-toggle="dropdown" aria-haspopup="true"
            aria-expanded="false">
            Course Topics
          </a>
          <div class="dropdown-menu" aria-labelledby="navbarDropdown">
            
            <a class="dropdown-item" href="https://foldable-robotics.github.io/modules/introduction/">Introduction</a>
            
            <a class="dropdown-item" href="https://foldable-robotics.github.io/modules/python/">Python</a>
            
            <a class="dropdown-item" href="https://foldable-robotics.github.io/modules/biomechanics/">Biomechanics</a>
            
            <a class="dropdown-item" href="https://foldable-robotics.github.io/modules/project/">Project</a>
            
            <a class="dropdown-item" href="https://foldable-robotics.github.io/modules/kinematics/">Kinematics</a>
            
            <a class="dropdown-item" href="https://foldable-robotics.github.io/modules/dynamics/">Dynamics</a>
            
            <a class="dropdown-item" href="https://foldable-robotics.github.io/modules/optimization/">Optimization</a>
            
            <a class="dropdown-item" href="https://foldable-robotics.github.io/modules/compliance/">Mechanics and Compliance</a>
            
            <a class="dropdown-item" href="https://foldable-robotics.github.io/modules/manufacturing/">Prototyping &amp; Manufacturing</a>
            
            <a class="dropdown-item" href="https://foldable-robotics.github.io/modules/validation/">Experimental Validation</a>
            
            <a class="dropdown-item" href="https://foldable-robotics.github.io/modules/integration/">Integration</a>
            
            <a class="dropdown-item" href="https://foldable-robotics.github.io/modules/misc/">Misc</a>
            
          </div>
        </li>
        
        
        
        <li class="nav-item">
          <a class="nav-link" href="https://foldable-robotics.github.io/assignments/">Assignments</a>
        </li>
        
        
        
        <li class="nav-item dropdown">
          <a class="nav-link dropdown-toggle" href="#" id="navbarDropdown" role="button" data-bs-toggle="dropdown" aria-haspopup="true"
            aria-expanded="false">
            Documents
          </a>
          <div class="dropdown-menu" aria-labelledby="navbarDropdown">
            
            <a class="dropdown-item" href="https://foldable-robotics.github.io/course-documents/all-documents/">All Documents</a>
            
            <a class="dropdown-item" href="https://foldable-robotics.github.io/course-documents/syllabus/">Syllabus</a>
            
            <a class="dropdown-item" href="https://foldable-robotics.github.io/course-documents/submission-best-practices/">Submission Best Practices</a>
            
            <a class="dropdown-item" href="https://foldable-robotics.github.io/course-documents/software-list/">Software List</a>
            
            <a class="dropdown-item" href="https://foldable-robotics.github.io/course-documents/course-calendar/">Course Calendar</a>
            
            <a class="dropdown-item" href="https://foldable-robotics.github.io/course-documents/suggested-materials-list/">Suggested Materials List</a>
            
          </div>
        </li>
        
        
        
      </ul>
      <span class="navbar-text">
        
      </span>

        <form action="https://foldable-robotics.github.io//search" class="d-flex">
        <input class="form-control me-2"  id="search-query"  name="s" type="s" placeholder="Search" aria-label="Search">
        <button class="btn btn-outline-secondary"  type="submit">Search</button>
      </form>
      
    </div>
  </div>
</nav>


    </div>

    
<main class="container">
  <h1>Solving Nonlinear Problems with Scipy Optimize and pyCMA</h1>
  
  





<div class="text-center">
<nav style="--bs-breadcrumb-divider: '>';" aria-label="breadcrumb">
  <ol class="breadcrumb">



<li class="breadcrumb-item"><a href="/modules">modules</a></li>




<li class="breadcrumb-item"><a href="/modules/optimization">optimization</a></li>




<li class="breadcrumb-item"><a href="/modules/optimization/generated">generated</a></li>




<li class="breadcrumb-item"><a href="/modules/optimization/generated/03-solving-nonlinear-problems">03-solving-nonlinear-problems</a></li>




<li class="breadcrumb-item active"  aria-current="page">index</li>

  </ol>
</nav>
</div>

  
  <article>
  <h2 id="introduction">Introduction</h2>
<p>Nonlinear solvers can suffer from the possibility of reaching local minima if the initial guess is too far away from the best minimum solution.  This is especially true when trying to fit nonlinear functions.  This example contrasts the difference between the scipy optimize function and the pyCMA package.</p>
<p>The pyCMA package provides python with an implementation of the &ldquo;covariance matrix adaptation evolutionary strategy&rdquo; (wikipedia page <a href="https://en.wikipedia.org/wiki/CMA-ES">here</a>).  You can install the pycma package from the command line by executing <code>pip install cma</code>.</p>
<div class="highlight"><pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#f92672">%</span><span style="color:#111">matplotlib</span> <span style="color:#111">inline</span>
</span></span></code></pre></div><p>Import all necessary packages</p>
<div class="highlight"><pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#f92672">import</span> <span style="color:#111">numpy</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> <span style="color:#111">matplotlib.pyplot</span> <span style="color:#00a8c8">as</span> <span style="color:#111">plt</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> <span style="color:#111">scipy.optimize</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> <span style="color:#111">numpy.random</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> <span style="color:#111">cma</span>
</span></span></code></pre></div><p>create a function for plotting solutions against the input data</p>
<div class="highlight"><pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#00a8c8">def</span> <span style="color:#75af00">plot_params</span><span style="color:#111">(</span><span style="color:#111">parameters</span><span style="color:#111">):</span>
</span></span><span style="display:flex;"><span>    <span style="color:#111">w</span><span style="color:#111">,</span><span style="color:#111">w0</span> <span style="color:#f92672">=</span> <span style="color:#111">parameters</span>
</span></span><span style="display:flex;"><span>    <span style="color:#111">y_model</span> <span style="color:#f92672">=</span> <span style="color:#111">numpy</span><span style="color:#f92672">.</span><span style="color:#111">sin</span><span style="color:#111">(</span><span style="color:#111">w</span><span style="color:#f92672">*</span><span style="color:#111">x</span><span style="color:#f92672">-</span><span style="color:#111">w</span><span style="color:#f92672">*</span><span style="color:#111">w0</span><span style="color:#111">)</span>
</span></span><span style="display:flex;"><span>    <span style="color:#111">p</span> <span style="color:#f92672">=</span> <span style="color:#111">plt</span><span style="color:#f92672">.</span><span style="color:#111">plot</span><span style="color:#111">(</span><span style="color:#111">x</span><span style="color:#111">,</span><span style="color:#111">y_model</span><span style="color:#111">,</span><span style="color:#d88200">&#39;r-.&#39;</span><span style="color:#111">)</span>
</span></span><span style="display:flex;"><span>    <span style="color:#111">p</span> <span style="color:#f92672">=</span> <span style="color:#111">plt</span><span style="color:#f92672">.</span><span style="color:#111">plot</span><span style="color:#111">(</span><span style="color:#111">x</span><span style="color:#111">,</span><span style="color:#111">y_data</span><span style="color:#111">,</span><span style="color:#d88200">&#39;bo&#39;</span><span style="color:#111">)</span>
</span></span><span style="display:flex;"><span>    <span style="color:#00a8c8">return</span> <span style="color:#111">p</span>
</span></span></code></pre></div><p>create the x array</p>
<div class="highlight"><pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#111">x</span> <span style="color:#f92672">=</span> <span style="color:#111">numpy</span><span style="color:#f92672">.</span><span style="color:#111">r_</span><span style="color:#111">[</span><span style="color:#f92672">-</span><span style="color:#ae81ff">10</span><span style="color:#111">:</span><span style="color:#ae81ff">10</span><span style="color:#111">:</span><span style="color:#ae81ff">.1</span><span style="color:#111">]</span>
</span></span></code></pre></div><p>define your model parameters</p>
<div class="highlight"><pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#111">parameters</span> <span style="color:#f92672">=</span> <span style="color:#111">(</span><span style="color:#ae81ff">2.1</span><span style="color:#111">,</span><span style="color:#ae81ff">.24</span><span style="color:#111">)</span>
</span></span></code></pre></div><p>split model parameters into frequency and frequency offset</p>
<div class="highlight"><pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#111">w</span><span style="color:#111">,</span><span style="color:#111">w0</span> <span style="color:#f92672">=</span> <span style="color:#111">parameters</span>
</span></span></code></pre></div><p>Build the original model as a sine function.  This is ideal because you can reach many local minima as a function of $\omega$ and $\omega_0$</p>
<div class="highlight"><pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#111">y</span> <span style="color:#f92672">=</span> <span style="color:#111">numpy</span><span style="color:#f92672">.</span><span style="color:#111">sin</span><span style="color:#111">(</span><span style="color:#111">w</span><span style="color:#f92672">*</span><span style="color:#111">x</span><span style="color:#f92672">-</span><span style="color:#111">w</span><span style="color:#f92672">*</span><span style="color:#111">w0</span><span style="color:#111">)</span>
</span></span></code></pre></div><p>Add some random noise</p>
<div class="highlight"><pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#111">rand</span> <span style="color:#f92672">=</span> <span style="color:#111">numpy</span><span style="color:#f92672">.</span><span style="color:#111">random</span><span style="color:#f92672">.</span><span style="color:#111">randn</span><span style="color:#111">(</span><span style="color:#f92672">*</span><span style="color:#111">y</span><span style="color:#f92672">.</span><span style="color:#111">shape</span><span style="color:#111">)</span><span style="color:#f92672">/</span><span style="color:#ae81ff">10</span>
</span></span><span style="display:flex;"><span><span style="color:#111">y_data</span> <span style="color:#f92672">=</span> <span style="color:#111">y</span><span style="color:#f92672">+</span><span style="color:#111">rand</span>
</span></span></code></pre></div><p>And plot the model data with noise against the original model</p>
<div class="highlight"><pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#111">fig</span> <span style="color:#f92672">=</span> <span style="color:#111">plt</span><span style="color:#f92672">.</span><span style="color:#111">figure</span><span style="color:#111">()</span>
</span></span><span style="display:flex;"><span><span style="color:#111">ax</span> <span style="color:#f92672">=</span> <span style="color:#111">fig</span><span style="color:#f92672">.</span><span style="color:#111">add_subplot</span><span style="color:#111">()</span>
</span></span><span style="display:flex;"><span><span style="color:#111">a</span><span style="color:#f92672">=</span><span style="color:#111">ax</span><span style="color:#f92672">.</span><span style="color:#111">plot</span><span style="color:#111">(</span><span style="color:#111">x</span><span style="color:#111">,</span><span style="color:#111">y</span><span style="color:#111">,</span><span style="color:#d88200">&#39;r&#39;</span><span style="color:#111">)</span>
</span></span><span style="display:flex;"><span><span style="color:#111">b</span><span style="color:#f92672">=</span><span style="color:#111">ax</span><span style="color:#f92672">.</span><span style="color:#111">plot</span><span style="color:#111">(</span><span style="color:#111">x</span><span style="color:#111">,</span><span style="color:#111">y_data</span><span style="color:#111">,</span><span style="color:#d88200">&#39;bo&#39;</span><span style="color:#111">)</span>
</span></span></code></pre></div><p><div class="text-center">
  <a href="output_17_0.png"><img src="output_17_0.png" alt="png"  style="max-width:80%; max-height:200px; width:auto; height: auto; text-align:center;"/></a>
</div></p>
<p>Now create a function that returns the sum of squared error between a model guess and the original model data</p>
<div class="highlight"><pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#00a8c8">def</span> <span style="color:#75af00">myfunc</span><span style="color:#111">(</span><span style="color:#111">parameters</span><span style="color:#111">):</span>
</span></span><span style="display:flex;"><span>    <span style="color:#111">w</span><span style="color:#111">,</span><span style="color:#111">w0</span> <span style="color:#f92672">=</span> <span style="color:#111">parameters</span>
</span></span><span style="display:flex;"><span>    <span style="color:#111">y_model</span> <span style="color:#f92672">=</span> <span style="color:#111">numpy</span><span style="color:#f92672">.</span><span style="color:#111">sin</span><span style="color:#111">(</span><span style="color:#111">w</span><span style="color:#f92672">*</span><span style="color:#111">x</span><span style="color:#f92672">-</span><span style="color:#111">w</span><span style="color:#f92672">*</span><span style="color:#111">w0</span><span style="color:#111">)</span>
</span></span><span style="display:flex;"><span>    <span style="color:#111">error</span> <span style="color:#f92672">=</span> <span style="color:#111">((</span><span style="color:#111">y_model</span><span style="color:#f92672">-</span><span style="color:#111">y_data</span><span style="color:#111">)</span><span style="color:#f92672">**</span><span style="color:#ae81ff">2</span><span style="color:#111">)</span><span style="color:#f92672">.</span><span style="color:#111">sum</span><span style="color:#111">()</span>
</span></span><span style="display:flex;"><span>    <span style="color:#00a8c8">return</span> <span style="color:#111">error</span>
</span></span></code></pre></div><p>Now find out the error of the actual model against its own noise;</p>
<div class="highlight"><pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#111">myfunc</span><span style="color:#111">([</span><span style="color:#ae81ff">2.1</span><span style="color:#111">,</span><span style="color:#ae81ff">.24</span><span style="color:#111">])</span>
</span></span></code></pre></div><pre><code>2.093829724940322
</code></pre>
<p>Now define an initial guess for the solver to try to find the parameters itself</p>
<div class="highlight"><pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#111">ini</span> <span style="color:#f92672">=</span> <span style="color:#111">[</span><span style="color:#ae81ff">1</span><span style="color:#111">,</span><span style="color:#ae81ff">.5</span><span style="color:#111">]</span>
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#111">sol</span> <span style="color:#f92672">=</span> <span style="color:#111">scipy</span><span style="color:#f92672">.</span><span style="color:#111">optimize</span><span style="color:#f92672">.</span><span style="color:#111">minimize</span><span style="color:#111">(</span><span style="color:#111">myfunc</span><span style="color:#111">,</span><span style="color:#111">ini</span><span style="color:#111">)</span>
</span></span><span style="display:flex;"><span><span style="color:#111">sol</span><span style="color:#f92672">.</span><span style="color:#111">fun</span>
</span></span></code></pre></div><pre><code>103.84110620139793
</code></pre>
<div class="highlight"><pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#111">sol</span><span style="color:#f92672">.</span><span style="color:#111">x</span>
</span></span></code></pre></div><pre><code>array([0.00774282, 3.58238206])
</code></pre>
<div class="highlight"><pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#111">plot_params</span><span style="color:#111">(</span><span style="color:#111">sol</span><span style="color:#f92672">.</span><span style="color:#111">x</span><span style="color:#111">)</span>
</span></span></code></pre></div><pre><code>[&lt;matplotlib.lines.Line2D at 0x7fe9fcc7e400&gt;]
</code></pre>
<p><div class="text-center">
  <a href="output_26_1.png"><img src="output_26_1.png" alt="png"  style="max-width:80%; max-height:200px; width:auto; height: auto; text-align:center;"/></a>
</div></p>
<p>Now rerun with a much closer initial guess</p>
<div class="highlight"><pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#111">ini</span> <span style="color:#f92672">=</span> <span style="color:#111">[</span><span style="color:#ae81ff">2</span><span style="color:#111">,</span><span style="color:#ae81ff">.5</span><span style="color:#111">]</span>
</span></span><span style="display:flex;"><span><span style="color:#111">sol</span> <span style="color:#f92672">=</span> <span style="color:#111">scipy</span><span style="color:#f92672">.</span><span style="color:#111">optimize</span><span style="color:#f92672">.</span><span style="color:#111">minimize</span><span style="color:#111">(</span><span style="color:#111">myfunc</span><span style="color:#111">,</span><span style="color:#111">ini</span><span style="color:#111">)</span>
</span></span><span style="display:flex;"><span><span style="color:#111">print</span><span style="color:#111">(</span><span style="color:#111">sol</span><span style="color:#f92672">.</span><span style="color:#111">fun</span><span style="color:#111">)</span>
</span></span><span style="display:flex;"><span><span style="color:#111">sol</span><span style="color:#f92672">.</span><span style="color:#111">x</span>
</span></span></code></pre></div><pre><code>2.0920946497952553





array([2.09997985, 0.24198467])
</code></pre>
<div class="highlight"><pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#111">plot_params</span><span style="color:#111">(</span><span style="color:#111">sol</span><span style="color:#f92672">.</span><span style="color:#111">x</span><span style="color:#111">)</span>
</span></span></code></pre></div><pre><code>[&lt;matplotlib.lines.Line2D at 0x7fe9fcbf7070&gt;]
</code></pre>
<p><div class="text-center">
  <a href="output_29_1.png"><img src="output_29_1.png" alt="png"  style="max-width:80%; max-height:200px; width:auto; height: auto; text-align:center;"/></a>
</div></p>
<div class="highlight"><pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#111">ini</span> <span style="color:#f92672">=</span> <span style="color:#111">[</span><span style="color:#ae81ff">.1</span><span style="color:#111">,</span><span style="color:#ae81ff">.5</span><span style="color:#111">]</span>
</span></span><span style="display:flex;"><span><span style="color:#111">sol</span> <span style="color:#f92672">=</span> <span style="color:#111">scipy</span><span style="color:#f92672">.</span><span style="color:#111">optimize</span><span style="color:#f92672">.</span><span style="color:#111">minimize</span><span style="color:#111">(</span><span style="color:#111">myfunc</span><span style="color:#111">,</span><span style="color:#111">ini</span><span style="color:#111">,</span><span style="color:#111">bounds</span><span style="color:#f92672">=</span><span style="color:#111">((</span><span style="color:#ae81ff">1.0</span><span style="color:#111">,</span> <span style="color:#ae81ff">4.1</span><span style="color:#111">),</span> <span style="color:#111">(</span><span style="color:#ae81ff">0</span><span style="color:#111">,</span><span style="color:#ae81ff">1</span><span style="color:#111">)),</span><span style="color:#111">method</span><span style="color:#f92672">=</span><span style="color:#d88200">&#34;powell&#34;</span><span style="color:#111">)</span>
</span></span><span style="display:flex;"><span><span style="color:#111">print</span><span style="color:#111">(</span><span style="color:#111">sol</span><span style="color:#f92672">.</span><span style="color:#111">fun</span><span style="color:#111">)</span>
</span></span><span style="display:flex;"><span><span style="color:#111">print</span><span style="color:#111">(</span><span style="color:#111">sol</span><span style="color:#f92672">.</span><span style="color:#111">x</span><span style="color:#111">)</span>
</span></span><span style="display:flex;"><span><span style="color:#111">plot_params</span><span style="color:#111">(</span><span style="color:#111">sol</span><span style="color:#f92672">.</span><span style="color:#111">x</span><span style="color:#111">)</span>
</span></span></code></pre></div><pre><code>2.0920955173209577
[2.09999615 0.2419855 ]


/tmp/ipykernel_11523/2516990896.py:2: OptimizeWarning: Initial guess is not within the specified bounds
  sol = scipy.optimize.minimize(myfunc,ini,bounds=((1.0, 4.1), (0,1)),method=&quot;powell&quot;)





[&lt;matplotlib.lines.Line2D at 0x7fe9fcb637c0&gt;]
</code></pre>
<p><div class="text-center">
  <a href="output_30_3.png"><img src="output_30_3.png" alt="png"  style="max-width:80%; max-height:200px; width:auto; height: auto; text-align:center;"/></a>
</div></p>
<h2 id="cma-example">CMA example</h2>
<p>Now we&rsquo;re going to try with pyCMA and the original initial guess</p>
<div class="highlight"><pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#111">ini</span> <span style="color:#f92672">=</span> <span style="color:#111">[</span><span style="color:#ae81ff">1</span><span style="color:#111">,</span><span style="color:#ae81ff">.5</span><span style="color:#111">]</span>
</span></span></code></pre></div><p>Run the optimization and display the results at the end.</p>
<div class="highlight"><pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#111">es</span> <span style="color:#f92672">=</span> <span style="color:#111">cma</span><span style="color:#f92672">.</span><span style="color:#111">CMAEvolutionStrategy</span><span style="color:#111">(</span><span style="color:#111">ini</span><span style="color:#111">,</span> <span style="color:#ae81ff">0.5</span><span style="color:#111">)</span>
</span></span><span style="display:flex;"><span><span style="color:#111">es</span><span style="color:#f92672">.</span><span style="color:#111">logger</span><span style="color:#f92672">.</span><span style="color:#111">disp_header</span><span style="color:#111">()</span>
</span></span><span style="display:flex;"><span><span style="color:#00a8c8">while</span> <span style="color:#f92672">not</span> <span style="color:#111">es</span><span style="color:#f92672">.</span><span style="color:#111">stop</span><span style="color:#111">():</span>
</span></span><span style="display:flex;"><span>      <span style="color:#111">X</span> <span style="color:#f92672">=</span> <span style="color:#111">es</span><span style="color:#f92672">.</span><span style="color:#111">ask</span><span style="color:#111">()</span>
</span></span><span style="display:flex;"><span>      <span style="color:#111">es</span><span style="color:#f92672">.</span><span style="color:#111">tell</span><span style="color:#111">(</span><span style="color:#111">X</span><span style="color:#111">,</span> <span style="color:#111">[</span><span style="color:#111">myfunc</span><span style="color:#111">(</span><span style="color:#111">x</span><span style="color:#111">)</span> <span style="color:#00a8c8">for</span> <span style="color:#111">x</span> <span style="color:#f92672">in</span> <span style="color:#111">X</span><span style="color:#111">])</span>
</span></span><span style="display:flex;"><span>      <span style="color:#111">es</span><span style="color:#f92672">.</span><span style="color:#111">logger</span><span style="color:#f92672">.</span><span style="color:#111">add</span><span style="color:#111">()</span>
</span></span><span style="display:flex;"><span><span style="color:#111">es</span><span style="color:#f92672">.</span><span style="color:#111">logger</span><span style="color:#f92672">.</span><span style="color:#111">disp</span><span style="color:#111">([</span><span style="color:#f92672">-</span><span style="color:#ae81ff">1</span><span style="color:#111">])</span>
</span></span></code></pre></div><pre><code>(3_w,6)-aCMA-ES (mu_w=2.0,w_1=63%) in dimension 2 (seed=1056100, Thu Apr 14 15:18:18 2022)
Iterat Nfevals  function value    axis ratio maxstd  minstd
  153    918 1.64074127665788e+02 8.3e+00 7.90e-09 1.08e-09
</code></pre>
<p>Plot the convergence of the CMA-ES algorithm</p>
<div class="highlight"><pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#111">es</span><span style="color:#f92672">.</span><span style="color:#111">logger</span><span style="color:#f92672">.</span><span style="color:#111">plot</span><span style="color:#111">()</span>
</span></span></code></pre></div><pre><code>&lt;cma.logger.CMADataLogger at 0x7fe9fcb8e6d0&gt;
</code></pre>
<p><div class="text-center">
  <a href="output_36_1.png"><img src="output_36_1.png" alt="png"  style="max-width:80%; max-height:200px; width:auto; height: auto; text-align:center;"/></a>
</div></p>
<div class="highlight"><pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#111">es</span><span style="color:#f92672">.</span><span style="color:#111">best</span><span style="color:#f92672">.</span><span style="color:#111">x</span>
</span></span></code></pre></div><pre><code>array([ 2.06681366, -3.00887613])
</code></pre>
<div class="highlight"><pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#111">myfunc</span><span style="color:#111">(</span><span style="color:#111">es</span><span style="color:#f92672">.</span><span style="color:#111">best</span><span style="color:#f92672">.</span><span style="color:#111">x</span><span style="color:#111">)</span>
</span></span></code></pre></div><pre><code>24.408652286226967
</code></pre>
<div class="highlight"><pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#111">plot_params</span><span style="color:#111">(</span><span style="color:#111">es</span><span style="color:#f92672">.</span><span style="color:#111">best</span><span style="color:#f92672">.</span><span style="color:#111">x</span><span style="color:#111">)</span>
</span></span></code></pre></div><pre><code>[&lt;matplotlib.lines.Line2D at 0x7fe9fc5ae970&gt;]
</code></pre>
<p><div class="text-center">
  <a href="output_39_1.png"><img src="output_39_1.png" alt="png"  style="max-width:80%; max-height:200px; width:auto; height: auto; text-align:center;"/></a>
</div></p>
<p>If you re-run this optimization, even with the same initial guess, there is no guarantee of convergence, especially when your initial guess is far away from the actual value.  This is because the success of the algorithm, as well as its ability to reach beyond local minima, is based on injecting randomness into each evolution of the algorithm.  This means that each optimization will produce slightly different results in a different number of steps.  This must be traded off for the ability to escape local minima.</p>
<div class="highlight"><pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#75715e">#import scipy.optimize.differential_evolution</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#111">res</span> <span style="color:#f92672">=</span> <span style="color:#111">scipy</span><span style="color:#f92672">.</span><span style="color:#111">optimize</span><span style="color:#f92672">.</span><span style="color:#111">differential_evolution</span><span style="color:#111">(</span>
</span></span><span style="display:flex;"><span>                <span style="color:#111">myfunc</span><span style="color:#111">,</span>
</span></span><span style="display:flex;"><span>                <span style="color:#111">bounds</span><span style="color:#f92672">=</span><span style="color:#111">[(</span><span style="color:#ae81ff">1.06</span><span style="color:#111">,</span><span style="color:#ae81ff">4.1</span><span style="color:#111">),(</span><span style="color:#ae81ff">0</span><span style="color:#111">,</span><span style="color:#ae81ff">1</span><span style="color:#111">)],</span>
</span></span><span style="display:flex;"><span>                <span style="color:#111">popsize</span><span style="color:#f92672">=</span><span style="color:#ae81ff">10</span><span style="color:#111">,</span>
</span></span><span style="display:flex;"><span>                <span style="color:#111">maxiter</span><span style="color:#f92672">=</span><span style="color:#ae81ff">2000</span><span style="color:#111">,</span>
</span></span><span style="display:flex;"><span>                <span style="color:#111">tol</span><span style="color:#f92672">=</span><span style="color:#ae81ff">1e-6</span><span style="color:#111">,</span>
</span></span><span style="display:flex;"><span>                <span style="color:#75715e">#callback=cb,</span>
</span></span><span style="display:flex;"><span>                <span style="color:#111">workers</span><span style="color:#f92672">=-</span><span style="color:#ae81ff">1</span><span style="color:#111">,</span>
</span></span><span style="display:flex;"><span>                <span style="color:#111">polish</span><span style="color:#f92672">=</span><span style="color:#00a8c8">False</span><span style="color:#111">,</span>
</span></span><span style="display:flex;"><span>                <span style="color:#111">disp</span><span style="color:#f92672">=</span><span style="color:#00a8c8">True</span>
</span></span><span style="display:flex;"><span>            <span style="color:#111">)</span>
</span></span></code></pre></div><pre><code>/home/danaukes/miniconda3/lib/python3.9/site-packages/scipy/optimize/_differentialevolution.py:533: UserWarning: differential_evolution: the 'workers' keyword has overridden updating='immediate' to updating='deferred'
  warnings.warn(&quot;differential_evolution: the 'workers' keyword has&quot;


differential_evolution step 1: f(x)= 11.8457
differential_evolution step 2: f(x)= 11.8457
differential_evolution step 3: f(x)= 11.1958
differential_evolution step 4: f(x)= 11.1958
differential_evolution step 5: f(x)= 11.1958
differential_evolution step 6: f(x)= 2.2656
differential_evolution step 7: f(x)= 2.2656
differential_evolution step 8: f(x)= 2.2656
differential_evolution step 9: f(x)= 2.2656
differential_evolution step 10: f(x)= 2.2656
differential_evolution step 11: f(x)= 2.2656
differential_evolution step 12: f(x)= 2.2656
differential_evolution step 13: f(x)= 2.17141
differential_evolution step 14: f(x)= 2.0949
differential_evolution step 15: f(x)= 2.0949
differential_evolution step 16: f(x)= 2.0949
differential_evolution step 17: f(x)= 2.0949
differential_evolution step 18: f(x)= 2.0949
differential_evolution step 19: f(x)= 2.0949
differential_evolution step 20: f(x)= 2.0949
differential_evolution step 21: f(x)= 2.09302
differential_evolution step 22: f(x)= 2.09274
differential_evolution step 23: f(x)= 2.09211
differential_evolution step 24: f(x)= 2.09211
differential_evolution step 25: f(x)= 2.09211
differential_evolution step 26: f(x)= 2.0921
differential_evolution step 27: f(x)= 2.0921
differential_evolution step 28: f(x)= 2.0921
differential_evolution step 29: f(x)= 2.09209
differential_evolution step 30: f(x)= 2.09209
differential_evolution step 31: f(x)= 2.09209
differential_evolution step 32: f(x)= 2.09209
differential_evolution step 33: f(x)= 2.09209
differential_evolution step 34: f(x)= 2.09209
</code></pre>
<div class="highlight"><pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#111">res</span>
</span></span></code></pre></div><pre><code>     fun: 2.0920947701810624
 message: 'Optimization terminated successfully.'
    nfev: 700
     nit: 34
 success: True
       x: array([2.09997756, 0.24196964])
</code></pre>
<div class="highlight"><pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#111">plot_params</span><span style="color:#111">(</span><span style="color:#111">res</span><span style="color:#f92672">.</span><span style="color:#111">x</span><span style="color:#111">)</span>
</span></span></code></pre></div><pre><code>[&lt;matplotlib.lines.Line2D at 0x7fe9facdcf70&gt;]
</code></pre>
<p><div class="text-center">
  <a href="output_43_1.png"><img src="output_43_1.png" alt="png"  style="max-width:80%; max-height:200px; width:auto; height: auto; text-align:center;"/></a>
</div></p>
<div class="highlight"><pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"></code></pre></div>
  </article>
</main>


    
    <footer class="blog-footer">
      <p>Copyright &copy; 2022 Daniel M. Aukes.  All rights reserved.</p>
      <p><a href="#">Back to top</a></p>
    </footer>
    

<script src="/bootstrap-5.0.2-dist/js/bootstrap.bundle.min.js" crossorigin="anonymous"></script>
<script src="https://foldable-robotics.github.io/js/jquery-3.3.1.min.js"></script>
<script src="https://foldable-robotics.github.io/js/fuse.min.js"></script>
<script src="https://foldable-robotics.github.io/js/jquery.mark.min.js"></script>
<script src="https://foldable-robotics.github.io/js/search.js"></script>

  </body>
</html>
